
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小鸟地图旅行规划</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<!-- 修改标题和说明部分 -->
<div class="container">
    <h1 class="main-title">
        <span class="icon">🐦</span>
        小鸟地图旅行规划系统
    </h1>

    <div class="section-divider">
        <div class="divider-line"></div>
        <span class="divider-text">智能路线规划系统</span>
        <div class="divider-line"></div>
    </div>

    <div class="instruction-box gradient-bg">
        <div class="instruction-header">
            <span class="icon">🗺️</span>
            <h2>使用指南</h2>
        </div>
        <div class="example-list">
            <div class="example-item">
                <span class="bullet">✨</span>
                <p>大理古城附近的景点步行路线规划</p>
            </div>
            <div class="example-item">
                <span class="bullet">🚗</span>
                <p>昆明到哈尔滨的导航路线</p>
            </div>
            <div class="example-item">
                <span class="bullet">🏨</span>
                <p>云南大学东陆校区附近酒店推荐</p>
            </div>
        </div>
    </div>

    <!-- 保持原有表单结构 -->
</div>
        <form id="queryForm">
            <div class="input-group">
                <input type="text" id="query" name="query"
                       placeholder="请输入目的地，例如：北京故宫附近的景点路线规划" required>
                <button type="submit">开始规划</button>
            </div>
        </form>

        <!-- 加载状态 -->
        <div id="loading" class="loading" style="display:none;">
            <div class="loader"></div>
            <p>正在努力规划路线中...</p>
        </div>

        <!-- 结果展示 -->
        <div id="resultContainer" class="result-container" style="display:none;">
            <div id="resultContent"></div>
            <button onclick="resetForm()" class="back-btn">重新规划</button>
        </div>
    </div>

<script>
document.getElementById('queryForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const query = document.getElementById('query').value;
    const resultDiv = document.getElementById('resultContent');
    const container = document.getElementById('resultContainer');
    const loading = document.getElementById('loading');

    loading.style.display = 'block';
    container.style.display = 'none';

    try {
        const response = await fetch('/process_query', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: `query=${encodeURIComponent(query)}`
        });

        const data = await response.json();
        loading.style.display = 'none';

        if (data.error) {
            resultDiv.innerHTML = `<div class="error">${data.error}</div>`;
        } else if (data.html_content) {
            // 直接使用后端格式化好的HTML
            resultDiv.innerHTML = data.html_content;
        } else {
            resultDiv.innerHTML = "未找到有效结果";
        }

        container.style.display = 'block';
        window.scrollTo({
            top: container.offsetTop - 50,
            behavior: 'smooth'
        });

    } catch (err) {
        loading.style.display = 'none';
        resultDiv.innerHTML = `<div class="error">请求失败：${err.message}</div>`;
        container.style.display = 'block';
    }
});
</script>
</body>
</html>
